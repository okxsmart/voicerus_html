<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Groq Voice Bot ‚Äî –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</title>
  <script src="https://code.responsivevoice.org/responsivevoice.js?key=FmSmJQPV"></script>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: sans-serif;
      margin: 20px;
    }
    h1 {
      color: #0f0;
      margin-bottom: 10px;
    }
    #chat-box {
      background: #222;
      border: 1px solid #444;
      height: 400px;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 10px;
      white-space: pre-wrap;
    }
    .message {
      margin-bottom: 8px;
      padding: 6px 10px;
      border-radius: 6px;
      max-width: 80%;
    }
    .user {
      background: #0a84ff22;
      color: #aaf;
      align-self: flex-end;
      margin-left: auto;
    }
    .bot {
      background: #28a74533;
      color: #8f8;
      align-self: flex-start;
      margin-right: auto;
    }
    #controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 8px;
    }
    select, textarea, button {
      background: #222;
      color: #eee;
      border: 1px solid #555;
      padding: 6px;
      font-size: 1rem;
      border-radius: 4px;
    }
    select {
      min-width: 180px;
    }
    textarea {
      width: 100%;
      resize: vertical;
      min-height: 70px;
    }
    button {
      cursor: pointer;
      min-width: 120px;
    }
    #status {
      font-size: 0.9rem;
      color: #ccc;
      margin-bottom: 6px;
      min-height: 20px;
    }
  </style>
</head>
<body>

  <h1>ü§ñ Groq Voice Bot ‚Äî –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</h1>

  <div id="controls">
    <label for="language">–Ø–∑—ã–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:</label>
    <select id="language" title="–Ø–∑—ã–∫ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞">
      <option value="uk-UA">–£–∫—Ä–∞–∏–Ω—Å–∫–∏–π üá∫üá¶</option>
      <option value="ru-RU" selected>–†—É—Å—Å–∫–∏–π üá∑üá∫</option>
      <option value="en-US">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π üá¨üáß</option>
    </select>

    <label for="model">–ú–æ–¥–µ–ª—å LLM:</label>
    <select id="model" title="–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏">
      <option value="llama3-70b-8192" selected>LLaMA 3 (70B)</option>
      <option value="llama3-8b-8192">LLaMA 3 (8B)</option>
      <option value="meta-llama/llama-4-maverick-17b-128e-instruct">LLaMA 4 Maverick (17B)</option>
      <option value="deepseek-r1-distill-llama-70b">DeepSeek Distill 70B</option>
      <option value="gemma2-9b-it">Gemma 2 (9B IT)</option>
    </select>

    <label for="voice" style="display:none;">–ì–æ–ª–æ—Å –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è:</label>
	<select id="voice" title="–ì–æ–ª–æ—Å –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞" style="display:none;">
	  <option value="Ukrainian Female" selected>–£–∫—Ä–∞–∏–Ω—Å–∫–∏–π –ñ–µ–Ω—Å–∫–∏–π</option>
	  <option value="Ukrainian Male">–£–∫—Ä–∞–∏–Ω—Å–∫–∏–π –ú—É–∂—Å–∫–æ–π</option>
	  <option value="Russian Female">–†—É—Å—Å–∫–∏–π –ñ–µ–Ω—Å–∫–∏–π</option>
	  <option value="UK English Female">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ñ–µ–Ω—Å–∫–∏–π</option>
	  <option value="UK English Male">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ú—É–∂—Å–∫–æ–π</option>
	</select>

  </div>

  <div id="chat-box" aria-live="polite" aria-label="–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞"></div>

  <div id="status"></div>

  <textarea id="user-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ üéôÔ∏è –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ..." rows="3" aria-label="–ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è"></textarea>

  <div id="controls" style="margin-top: 8px;">
    <button id="btn-send">üì© –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <button id="btn-voice">üéôÔ∏è –ì–æ–ª–æ—Å–æ–º</button>
    <button id="btn-clear">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
    <button id="btn-speak">üîä –û—Ç–≤–µ—Ç–∏—Ç—å –≥–æ–ª–æ—Å–æ–º</button>
  </div>

  <script>
    const chatBox = document.getElementById("chat-box");
    const userInput = document.getElementById("user-input");
    const btnSend = document.getElementById("btn-send");
    const btnVoice = document.getElementById("btn-voice");
    const btnClear = document.getElementById("btn-clear");
    const btnSpeak = document.getElementById("btn-speak");
    const languageSelect = document.getElementById("language");
    const modelSelect = document.getElementById("model");
    const voiceSelect = document.getElementById("voice");
    const statusDiv = document.getElementById("status");

    const API_KEY = "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"; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π –∫–ª—é—á!

    let lastBotResponse = "";
    let recognition = null;
    let recognizing = false;

    // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
    function appendMessage(sender, text) {
      const msgDiv = document.createElement("div");
      msgDiv.className = "message " + (sender === "user" ? "user" : "bot");
      msgDiv.textContent = (sender === "user" ? "üßë: " : "ü§ñ: ") + text;
      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä (Groq API)
    async function sendMessage(text) {
      appendMessage("user", text);
      statusDiv.textContent = "‚è≥ –û–∂–∏–¥–∞—é –æ—Ç–≤–µ—Ç...";
      btnSend.disabled = true;
      btnVoice.disabled = true;

      const model = modelSelect.value;
      const lang = languageSelect.value;
      const systemPrompt = lang.startsWith("ru") 
        ? "–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –û—Ç–≤–µ—á–∞–π —á–µ—Ç–∫–æ –∏ –∫—Ä–∞—Ç–∫–æ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤." 
        : lang.startsWith("en") 
          ? "You are a helpful assistant. Please respond clearly and concisely, no filler words." 
          : "–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –û—Ç–≤–µ—á–∞–π —á–µ—Ç–∫–æ –∏ –∫—Ä–∞—Ç–∫–æ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤.";

      const payload = {
        model,
        messages: [
          { role: "system", content: systemPrompt },
          { role: "user", content: text }
        ],
        temperature: 0.3,
        max_tokens: 512
      };

      try {
        const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + API_KEY,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          throw new Error("–û—à–∏–±–∫–∞ API: " + res.status);
        }

        const data = await res.json();
        const botText = data.choices?.[0]?.message?.content?.trim() || "‚ö†Ô∏è –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç";

        appendMessage("bot", botText);
        lastBotResponse = botText;
        statusDiv.textContent = "";

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
        speak(botText, lang);
      } catch (err) {
        appendMessage("bot", "‚ö†Ô∏è –û—à–∏–±–∫–∞: " + err.message);
        statusDiv.textContent = "";
      } finally {
        btnSend.disabled = false;
        btnVoice.disabled = false;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    function speak(text, lang) {
      const voiceMap = {
        "uk-UA": "Ukrainian Female",
        "ru-RU": "Russian Female",
        "en-US": "UK English Female"
      };
      const voiceName = voiceMap[lang] || "Russian Female";
      if (responsiveVoice.voiceSupport()) {
        responsiveVoice.speak(text, voiceName);
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
    btnSend.addEventListener("click", () => {
      const text = userInput.value.trim();
      if (text) {
        userInput.value = "";
        sendMessage(text);
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à–∏ Enter (–±–µ–∑ Shift) –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        btnSend.click();
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç"
    btnClear.addEventListener("click", () => {
      chatBox.innerHTML = "";
      lastBotResponse = "";
      statusDiv.textContent = "";
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–û—Ç–≤–µ—Ç–∏—Ç—å –≥–æ–ª–æ—Å–æ–º"
    btnSpeak.addEventListener("click", () => {
      if (lastBotResponse) {
        speak(lastBotResponse, languageSelect.value);
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
    btnVoice.addEventListener("click", () => {
      if (!('webkitSpeechRecognition' in window)) {
        alert("–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º.");
        return;
      }

      if (recognizing) {
        recognition.stop();
        return;
      }

      recognition = new webkitSpeechRecognition();
      recognition.lang = languageSelect.value;
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => {
        recognizing = true;
        statusDiv.textContent = "üé§ –ì–æ–≤–æ—Ä–∏—Ç–µ...";
        btnVoice.textContent = "‚ñ† –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å";
        btnSend.disabled = true;
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—Å–ª–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
        recognition.stop();
        sendMessage(transcript);
      };

      recognition.onerror = (event) => {
        alert("–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≥–æ–ª–æ—Å–∞: " + event.error);
        recognizing = false;
        btnVoice.textContent = "üéôÔ∏è –ì–æ–ª–æ—Å–æ–º";
        btnSend.disabled = false;
        statusDiv.textContent = "";
      };

      recognition.onend = () => {
        recognizing = false;
        btnVoice.textContent = "üéôÔ∏è –ì–æ–ª–æ—Å–æ–º";
        btnSend.disabled = false;
        if (!userInput.value) {
          statusDiv.textContent = "";
        }
      };

      recognition.start();
    });

  </script>
</body>
</html>
